/*! msal v0.1.1 2017-05-09 */

"use strict";var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Msal;!function(a){var b;!function(a){a[a.Aad=0]="Aad",a[a.Adfs=1]="Adfs",a[a.B2C=2]="B2C"}(b=a.AuthorityType||(a.AuthorityType={}));var c=function(){function c(a,b){this.IsValidationEnabled=b,this.CanonicalAuthority=a,this.validateAsUri()}return Object.defineProperty(c.prototype,"Tenant",{get:function(){return this.CanonicalAuthorityUrlComponents.PathSegments[0]},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"AuthorizationEndpoint",{get:function(){return this.validateResolved(),this.tenantDiscoveryResponse.AuthorizationEndpoint.replace("{tenant}",this.Tenant)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"EndSessionEndpoint",{get:function(){return this.validateResolved(),this.tenantDiscoveryResponse.EndSessionEndpoint.replace("{tenant}",this.Tenant)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"SelfSignedJwtAudience",{get:function(){return this.validateResolved(),this.tenantDiscoveryResponse.Issuer.replace("{tenant}",this.Tenant)},enumerable:!0,configurable:!0}),c.prototype.validateResolved=function(){if(!this.tenantDiscoveryResponse)throw"Please call ResolveEndpointsAsync first"},Object.defineProperty(c.prototype,"CanonicalAuthority",{get:function(){return this.canonicalAuthority},set:function(b){this.canonicalAuthority=a.Utils.CanonicalizeUri(b),this.canonicalAuthorityUrlComponents=null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"CanonicalAuthorityUrlComponents",{get:function(){return this.canonicalAuthorityUrlComponents||(this.canonicalAuthorityUrlComponents=a.Utils.GetUrlComponents(this.CanonicalAuthority)),this.canonicalAuthorityUrlComponents},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"DefaultOpenIdConfigurationEndpoint",{get:function(){return this.CanonicalAuthority+"v2.0/.well-known/openid-configuration"},enumerable:!0,configurable:!0}),c.prototype.validateAsUri=function(){var b;try{b=this.CanonicalAuthorityUrlComponents}catch(b){throw a.ErrorMessage.invalidAuthorityType}if(!b.Protocol||"https:"!==b.Protocol.toLowerCase())throw a.ErrorMessage.authorityUriInsecure;if(!b.PathSegments||b.PathSegments.length<1)throw a.ErrorMessage.authorityUriInvalidPath},c.DetectAuthorityFromUrl=function(c){switch(c=a.Utils.CanonicalizeUri(c),a.Utils.GetUrlComponents(c).PathSegments[0]){case"tfp":return b.B2C;case"adfs":return b.Adfs;default:return b.Aad}},c.CreateInstance=function(d,e){switch(c.DetectAuthorityFromUrl(d)){case b.B2C:return new a.B2cAuthority(d,e);case b.Aad:return new a.AadAuthority(d,e);default:throw a.ErrorMessage.invalidAuthorityType}},c.prototype.DiscoverEndpoints=function(b){return(new a.XhrClient).sendRequestAsync(b,"GET",!0).then(function(a){return{AuthorizationEndpoint:a.authorization_endpoint,EndSessionEndpoint:a.end_session_endpoint,Issuer:a.issuer}})},c.prototype.ResolveEndpointsAsync=function(){var a=this,b="";return this.GetOpenIdConfigurationEndpointAsync().then(function(c){return b=c,a.DiscoverEndpoints(b)}).then(function(b){return a.tenantDiscoveryResponse=b,a})},c}();a.Authority=c}(Msal||(Msal={}));var Msal;!function(a){var b=function(b){function c(a,c){return b.call(this,a,c)||this}return __extends(c,b),Object.defineProperty(c.prototype,"AadInstanceDiscoveryEndpointUrl",{get:function(){return c.AadInstanceDiscoveryEndpoint+"?api-version=1.0&authorization_endpoint="+this.CanonicalAuthority+"oauth2/v2.0/authorize"},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"AuthorityType",{get:function(){return a.AuthorityType.Aad},enumerable:!0,configurable:!0}),c.prototype.GetOpenIdConfigurationEndpointAsync=function(){var b=this,c=new Promise(function(a,c){return a(b.DefaultOpenIdConfigurationEndpoint)});if(!this.IsValidationEnabled)return c;var d=this.CanonicalAuthorityUrlComponents.HostNameAndPort;return this.IsInTrustedHostList(d)?c:(new a.XhrClient).sendRequestAsync(this.AadInstanceDiscoveryEndpointUrl,"GET",!0).then(function(a){return a.tenant_discovery_endpoint})},c.prototype.IsInTrustedHostList=function(a){return c.TrustedHostList[a.toLowerCase()]},c}(a.Authority);b.AadInstanceDiscoveryEndpoint="https://login.microsoftonline.com/common/discovery/instance",b.TrustedHostList={"login.windows.net":"login.windows.net","login.chinacloudapi.cn":"login.chinacloudapi.cn","login.cloudgovapi.us":"login.cloudgovapi.us","login.microsoftonline.com":"login.microsoftonline.com","login.microsoftonline.de":"login.microsoftonline.de"},a.AadAuthority=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function a(a,b){this.key=a,this.value=b}return a}();a.AccessTokenCacheItem=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function b(b,c,d,e,f){this.authority=b,this.clientId=c,this.scopes=d,this.userIdentifier=a.Utils.base64EncodeStringUrlSafe(e)+"."+a.Utils.base64EncodeStringUrlSafe(f)}return b}();a.AccessTokenKey=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function a(a,b,c,d){this.accessToken=a,this.idToken=b,this.expiresIn=c,this.clientInfo=d}return a}();a.AccessTokenValue=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function b(b,c,d,e,f){this.authorityInstance=b,this.clientId=c,this.scopes=d,this.responseType=e,this.redirectUri=f,this.correlationId=a.Utils.createNewGuid(),this.state=a.Utils.createNewGuid(),this.nonce=a.Utils.createNewGuid(),this.xClientSku="MSAL.JS",this.xClientVer=a.Utils.getLibraryVersion()}return Object.defineProperty(b.prototype,"authority",{get:function(){return this.authorityInstance.CanonicalAuthority},enumerable:!0,configurable:!0}),b.prototype.createNavigateUrl=function(a){a||(a=[this.clientId]),-1===a.indexOf(this.clientId)&&a.push(this.clientId);var b=[];b.push("response_type="+this.responseType),this.translateclientIdUsedInScope(a),b.push("scope="+encodeURIComponent(this.parseScope(a))),b.push("client_id="+encodeURIComponent(this.clientId)),b.push("redirect_uri="+encodeURIComponent(this.redirectUri)),b.push("state="+encodeURIComponent(this.state)),b.push("nonce="+encodeURIComponent(this.nonce)),b.push("client_info=1"),b.push("x-client-SKU="+this.xClientSku),b.push("x-client-Ver="+this.xClientVer),this.extraQueryParameters&&b.push(this.extraQueryParameters),b.push("client-request-id="+encodeURIComponent(this.correlationId));var c=this.authorityInstance.AuthorizationEndpoint;return c.indexOf("?")<0?c+="?":c+="&",""+c+b.join("&")},b.prototype.translateclientIdUsedInScope=function(a){var b=a.indexOf(this.clientId);b>=0&&(a.splice(b,1),-1===a.indexOf("openid")&&a.push("openid"),-1===a.indexOf("profile")&&a.push("profile"))},b.prototype.parseScope=function(a){var b="";if(a)for(var c=0;c<a.length;++c)b+=c!==a.length-1?a[c]+" ":a[c];return b},b}();a.AuthenticationRequestParameters=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(b){function c(c,d){var e=b.call(this,c,d)||this,f=a.Utils.GetUrlComponents(c),g=f.PathSegments;if(g.length<3)throw a.ErrorMessage.b2cAuthorityUriInvalidPath;return e.CanonicalAuthority="https://"+f.HostNameAndPort+"/"+g[0]+"/"+g[1]+"/"+g[2]+"/",e}return __extends(c,b),Object.defineProperty(c.prototype,"AuthorityType",{get:function(){return a.AuthorityType.B2C},enumerable:!0,configurable:!0}),c.prototype.GetOpenIdConfigurationEndpointAsync=function(){var b=this,c=new Promise(function(a,c){return a(b.DefaultOpenIdConfigurationEndpoint)});return this.IsValidationEnabled?this.IsInTrustedHostList(this.CanonicalAuthorityUrlComponents.HostNameAndPort)?c:new Promise(function(b,c){return c(a.ErrorMessage.unsupportedAuthorityValidation)}):c},c}(a.AadAuthority);a.B2cAuthority=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function b(b){if(!b||a.Utils.isEmpty(b))return this.uid="",void(this.utid="");try{var c=a.Utils.base64DecodeStringUrlSafe(b),d=JSON.parse(c);d&&(d.hasOwnProperty("uid")&&(this.uid=d.uid),d.hasOwnProperty("utid")&&(this.utid=d.utid))}catch(a){throw new Error(a)}}return Object.defineProperty(b.prototype,"uid",{get:function(){return this._uid?this._uid:""},set:function(a){this._uid=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"utid",{get:function(){return this._utid?this._utid:""},set:function(a){this._utid=a},enumerable:!0,configurable:!0}),b}();a.ClientInfo=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function a(){}return Object.defineProperty(a,"errorDescription",{get:function(){return"error_description"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"error",{get:function(){return"error"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"scope",{get:function(){return"scope"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"acquireTokenUser",{get:function(){return"msal_acquireTokenUser"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"clientInfo",{get:function(){return"client_info"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"clientId",{get:function(){return"clientId"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"authority",{get:function(){return"authority"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"idToken",{get:function(){return"id_token"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"accessToken",{get:function(){return"access_token"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"expiresIn",{get:function(){return"expires_in"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"sessionState",{get:function(){return"session_state"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"tokenKeys",{get:function(){return"msal.token.keys"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"accessTokenKey",{get:function(){return"msal.access.token.key"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"expirationKey",{get:function(){return"msal.expiration.key"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"stateLogin",{get:function(){return"msal.state.login"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"stateAcquireToken",{get:function(){return"msal.state.acquireToken"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"stateRenew",{get:function(){return"msal.state.renew"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"nonceIdToken",{get:function(){return"msal.nonce.idtoken"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"userName",{get:function(){return"msal.username"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"idTokenKey",{get:function(){return"msal.idtoken"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"loginRequest",{get:function(){return"msal.login.request"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"loginError",{get:function(){return"msal.login.error"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"renewStatus",{get:function(){return"msal.token.renew.status"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"resourceDelimeter",{get:function(){return"|"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"loadFrameTimeout",{get:function(){return this._loadFrameTimeout},set:function(a){this._loadFrameTimeout=a},enumerable:!0,configurable:!0}),Object.defineProperty(a,"tokenRenewStatusCancelled",{get:function(){return"Canceled"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"tokenRenewStatusCompleted",{get:function(){return"Completed"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"tokenRenewStatusInProgress",{get:function(){return"In Progress"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"popUpWidth",{get:function(){return this._popUpWidth},set:function(a){this._popUpWidth=a},enumerable:!0,configurable:!0}),Object.defineProperty(a,"popUpHeight",{get:function(){return this._popUpHeight},set:function(a){this._popUpHeight=a},enumerable:!0,configurable:!0}),Object.defineProperty(a,"login",{get:function(){return"LOGIN"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"renewToken",{get:function(){return"renewToken"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"unknown",{get:function(){return"UNKNOWN"},enumerable:!0,configurable:!0}),a}();b._loadFrameTimeout=6e3,b._popUpWidth=483,b._popUpHeight=600,a.Constants=b;var c=function(){function a(){}return Object.defineProperty(a,"loginProgressError",{get:function(){return"login_progress_error"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"acquireTokenProgressError",{get:function(){return"acquiretoken_progress_error"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"inputScopesError",{get:function(){return"input_scopes_error"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"endpointResolutionError",{get:function(){return"endpoints_resolution_error"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"popUpWindowError",{get:function(){return"popup_window_error"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"userLoginError",{get:function(){return"user_login_error"},enumerable:!0,configurable:!0}),a}();a.ErrorCodes=c;var d=function(){function a(){}return Object.defineProperty(a,"loginProgressError",{get:function(){return"Login is in progress"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"acquireTokenProgressError",{get:function(){return"Acquire token is in progress"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"inputScopesError",{get:function(){return"Invalid value of input scopes provided"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"endpointResolutionError",{get:function(){return"Endpoints cannot be resolved"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"popUpWindowError",{get:function(){return"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser."},enumerable:!0,configurable:!0}),Object.defineProperty(a,"userLoginError",{get:function(){return"User login is required"},enumerable:!0,configurable:!0}),a}();a.ErrorDescription=d}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function a(){}return Object.defineProperty(a,"authorityUriInvalidPath",{get:function(){return"AuthorityUriInvalidPath"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"authorityUriInsecure",{get:function(){return"AuthorityUriInsecure"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"invalidAuthorityType",{get:function(){return"InvalidAuthorityType"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"unsupportedAuthorityValidation",{get:function(){return"UnsupportedAuthorityValidation"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"b2cAuthorityUriInvalidPath",{get:function(){return"B2cAuthorityUriInvalidPath"},enumerable:!0,configurable:!0}),a}();a.ErrorMessage=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function b(b){if(a.Utils.isEmpty(b))throw new Error("null or empty raw idtoken");try{this.rawIdToken=b;var c=a.Utils.extractIdToken(b);c&&(c.hasOwnProperty("iss")&&(this.issuer=c.iss),c.hasOwnProperty("oid")&&(this.objectId=c.oid),c.hasOwnProperty("sub")&&(this.subject=c.sub),c.hasOwnProperty("tid")&&(this.tenantId=c.tid),c.hasOwnProperty("ver")&&(this.version=c.ver),c.hasOwnProperty("preferred_username")&&(this.preferredName=c.preferred_username),c.hasOwnProperty("name")&&(this.name=c.name),c.hasOwnProperty("nonce")&&(this.nonce=c.nonce),c.hasOwnProperty("exp")&&(this.expiration=c.exp))}catch(a){throw new Error("Failed to parse the returned id token")}}return b}();a.IdToken=b}(Msal||(Msal={}));var Msal;!function(a){var b;!function(a){a[a.Error=0]="Error",a[a.Warning=1]="Warning",a[a.Info=2]="Info",a[a.Verbose=3]="Verbose"}(b=a.LogLevel||(a.LogLevel={}));var c=function(){function c(a){return this._level=b.Info,this._piiLoggingEnabled=!1,c._instance?c._instance:(this._correlationId=a,c._instance=this,c._instance)}return Object.defineProperty(c.prototype,"correlationId",{get:function(){return this._correlationId},set:function(a){this._correlationId=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"level",{get:function(){return this._level},set:function(a){if(!b[a])throw new Error("Provide a valid value for level. Possibles range for logLevel is 0-3");this._level=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"piiLoggingEnabled",{get:function(){return this._piiLoggingEnabled},set:function(a){this._piiLoggingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"localCallback",{get:function(){return this._localCallback},set:function(a){if(this.localCallback)throw new Error("MSAL logging callback can only be set once per process and should never change once set.");this._localCallback=a},enumerable:!0,configurable:!0}),c.prototype.logMessage=function(c,d,e){if(!(d>this.level||!this.piiLoggingEnabled&&e)){var f,g=(new Date).toUTCString();f=a.Utils.isEmpty(this.correlationId)?g+":"+a.Utils.getLibraryVersion()+"-"+b[d]+" "+c:g+":"+this._correlationId+"-"+a.Utils.getLibraryVersion()+"-"+b[d]+" "+c,this.executeCallback(d,f,e)}},c.prototype.executeCallback=function(a,b,c){this.localCallback&&this.localCallback(a,b,c)},c.prototype.error=function(a){this.logMessage(a,b.Error,!1)},c.prototype.errorPii=function(a){this.logMessage(a,b.Error,!0)},c.prototype.warning=function(a){this.logMessage(a,b.Warning,!1)},c.prototype.warningPii=function(a){this.logMessage(a,b.Warning,!0)},c.prototype.info=function(a){this.logMessage(a,b.Info,!1)},c.prototype.infoPii=function(a){this.logMessage(a,b.Info,!0)},c.prototype.verbose=function(a){this.logMessage(a,b.Verbose,!1)},c.prototype.verbosePii=function(a){this.logMessage(a,b.Verbose,!0)},c}();a.Logger=c}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function b(c){if(b._instance)return b._instance;this._logger=new a.Logger(c),this._correlationId=this._logger.correlationId,b._instance=this}return Object.defineProperty(b.prototype,"correlationId",{get:function(){return this._correlationId},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"logger",{get:function(){return this._logger},enumerable:!0,configurable:!0}),b}();a.RequestContext=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function a(){this.valid=!1,this.parameters={},this.stateMatch=!1,this.stateResponse="",this.requestType="unknown"}return a}();a.TokenResponse=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function b(a){if(b._instance)return b._instance;if(this._cacheLocation=a,this._localStorageSupported=void 0!==window[this._cacheLocation]&&null!=window[this._cacheLocation],this._sessionStorageSupported=void 0!==window[a]&&null!=window[a],b._instance=this,!this._localStorageSupported&&!this._sessionStorageSupported)throw new Error("localStorage and sessionStorage not supported");return b._instance}return b.prototype.setItem=function(a,b){if(!window[this._cacheLocation])throw new Error("localStorage and sessionStorage are not supported");window[this._cacheLocation].setItem(a,b)},b.prototype.getItem=function(a){if(window[this._cacheLocation])return window[this._cacheLocation].getItem(a);throw new Error("localStorage and sessionStorage are not supported")},b.prototype.removeItem=function(a){if(window[this._cacheLocation])return window[this._cacheLocation].removeItem(a);throw new Error("localStorage and sessionStorage are not supported")},b.prototype.clear=function(){if(window[this._cacheLocation])return window[this._cacheLocation].clear();throw new Error("localStorage and sessionStorage are not supported")},b.prototype.getAllAccessTokens=function(b,c){var d,e=[],f=window[this._cacheLocation];if(!f)throw new Error("localStorage and sessionStorage are not supported");var g=void 0;for(g in f)if(f.hasOwnProperty(g)&&g.match(b)&&g.match(c)){var h=this.getItem(g);h&&(d=new a.AccessTokenCacheItem(JSON.parse(g),JSON.parse(h)),e.push(d))}return e},b.prototype.removeAcquireTokenEntries=function(a,b){var c=window[this._cacheLocation];if(!c)throw new Error("localStorage and sessionStorage are not supported");var d=void 0;for(d in c)c.hasOwnProperty(d)&&(d.indexOf(a)>-1||d.indexOf(b)>-1)&&this.removeItem(d)},b.prototype.resetCacheItems=function(){var a=window[this._cacheLocation];if(!a)throw new Error("localStorage and sessionStorage are not supported");var b=void 0;for(b in a)a.hasOwnProperty(b)&&(a[b]="")},b}();a.Storage=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function a(){}return a.prototype.RegisterReceiver=function(a){this.receiverCallback=a},a.GetInstance=function(){return this.instance||(this.instance=new this)},a}();a.Telemetry=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function b(a,b,c,d){this.displayableId=a,this.name=b,this.identityProvider=c,this.userIdentifier=d}return b.createUser=function(c,d,e){var f,g;d?(f=d.uid,g=d.utid):(f="",g="");var h=a.Utils.base64EncodeStringUrlSafe(f)+"."+a.Utils.base64EncodeStringUrlSafe(g);return new b(c.preferredName,c.name,c.issuer,h)},b}();a.User=b}(Msal||(Msal={}));var Msal;!function(a){var b={id_token:"id_token",token:"token",id_token_token:"id_token token"},c=function(){function c(b,c,d,e){if(this._cacheLocations={localStorage:"localStorage",sessionStorage:"sessionStorage"},this._cacheLocation="sessionStorage",this._interactionModes={popUp:"popUp",redirect:"redirect"},this._interactionMode="redirect",this._clockSkew=300,this._tokenReceivedCallback=null,this.navigateToLoginRequestUrl=!0,this.clientId=b,this.validateAuthority=!0===e,this.authority=c||"https://login.microsoftonline.com/common",d&&(this._tokenReceivedCallback=d),this.redirectUri=window.location.href.split("?")[0].split("#")[0],this.postLogoutredirectUri=this.redirectUri,this._loginInProgress=!1,this._acquireTokenInProgress=!1,this._renewStates=[],this._activeRenewals={},this._cacheStorage=new a.Storage(this._cacheLocation),this._requestContext=new a.RequestContext(""),window.msal=this,window.callBackMappedToRenewStates={},window.callBacksMappedToRenewStates={},!window.opener){this.isCallback(window.location.hash)&&this.handleAuthenticationResponse(window.location.hash)}}return Object.defineProperty(c.prototype,"cacheLocation",{get:function(){return this._cacheLocation},set:function(b){if(this._cacheLocation=b,!this._cacheLocations[b])throw new Error("Cache Location is not valid. Provided value:"+this._cacheLocation+".Possible values are: "+this._cacheLocations.localStorage+", "+this._cacheLocations.sessionStorage);this._cacheStorage=new a.Storage(this._cacheLocations[b])},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"authority",{get:function(){return this.authorityInstance.CanonicalAuthority},set:function(b){this.authorityInstance=a.Authority.CreateInstance(b,this.validateAuthority)},enumerable:!0,configurable:!0}),c.prototype.loginRedirect=function(c,d){var e=this;if(this._loginInProgress&&this._tokenReceivedCallback)return void this._tokenReceivedCallback("Login is in progress",null,null,a.Constants.idToken);if(c){var f=this.validateInputScope(c);if(f&&!a.Utils.isEmpty(f)&&this._tokenReceivedCallback)return void this._tokenReceivedCallback(f,null,null,a.Constants.idToken);c=this.filterScopes(c)}this.authorityInstance.ResolveEndpointsAsync().then(function(){var f=new a.AuthenticationRequestParameters(e.authorityInstance,e.clientId,c,b.id_token,e.redirectUri);d&&(f.extraQueryParameters=d),e._cacheStorage.setItem(a.Constants.loginRequest,window.location.href),e._cacheStorage.setItem(a.Constants.loginError,""),e._cacheStorage.setItem(a.Constants.stateLogin,f.state),e._cacheStorage.setItem(a.Constants.nonceIdToken,f.nonce),e._cacheStorage.setItem(a.Constants.error,""),e._cacheStorage.setItem(a.Constants.errorDescription,"");var g=a.Constants.authority+a.Constants.resourceDelimeter+f.state;a.Utils.isEmpty(e._cacheStorage.getItem(g))&&e._cacheStorage.setItem(g,e.authority);var h=f.createNavigateUrl(c)+"&prompt=select_account&response_mode=fragment";e._loginInProgress=!0,e.promptUser(h)})},c.prototype.loginPopup=function(c,d){var e=this;return new Promise(function(f,g){if(e._interactionMode=e._interactionModes.popUp,e._loginInProgress)return void g(a.ErrorCodes.loginProgressError+":"+a.ErrorDescription.loginProgressError);if(c){var h=e.validateInputScope(c);if(h&&!a.Utils.isEmpty(h))return void g(a.ErrorCodes.inputScopesError+":"+a.ErrorDescription.inputScopesError);c=e.filterScopes(c)}var i=e.openWindow("about:blank","_blank",1,e,f,g);i&&e.authorityInstance.ResolveEndpointsAsync().then(function(){var f=new a.AuthenticationRequestParameters(e.authorityInstance,e.clientId,c,b.id_token,e.redirectUri);d&&(f.extraQueryParameters=d),e._cacheStorage.setItem(a.Constants.loginRequest,window.location.href),e._cacheStorage.setItem(a.Constants.loginError,""),e._cacheStorage.setItem(a.Constants.stateLogin,f.state),e._cacheStorage.setItem(a.Constants.nonceIdToken,f.nonce),e._cacheStorage.setItem(a.Constants.error,""),e._cacheStorage.setItem(a.Constants.errorDescription,"");var g=a.Constants.authority+a.Constants.resourceDelimeter+f.state;a.Utils.isEmpty(e._cacheStorage.getItem(g))&&e._cacheStorage.setItem(g,e.authority);var h=f.createNavigateUrl(c)+"&prompt=select_account&response_mode=fragment";e._loginInProgress=!0,i&&(i.location.href=h)},function(){e._requestContext.logger.info(a.ErrorCodes.endpointResolutionError+":"+a.ErrorDescription.endpointResolutionError),e._cacheStorage.setItem(a.Constants.error,a.ErrorCodes.endpointResolutionError),e._cacheStorage.setItem(a.Constants.errorDescription,a.ErrorDescription.endpointResolutionError),g&&g(a.ErrorCodes.endpointResolutionError+":"+a.ErrorDescription.endpointResolutionError),i&&i.close()})})},c.prototype.promptUser=function(b){b&&!a.Utils.isEmpty(b)?(this._requestContext.logger.info("Navigate to:"+b),window.location.replace(b)):this._requestContext.logger.info("Navigate url is empty")},c.prototype.openWindow=function(b,c,d,e,f,g){var h=this,i=this.openPopup(b,c,a.Constants.popUpWidth,a.Constants.popUpHeight);if(null==i)return e._loginInProgress=!1,e._acquireTokenInProgress=!1,this._requestContext.logger.info(a.ErrorCodes.popUpWindowError+":"+a.ErrorDescription.popUpWindowError),this._cacheStorage.setItem(a.Constants.error,a.ErrorCodes.popUpWindowError),this._cacheStorage.setItem(a.Constants.errorDescription,a.ErrorDescription.popUpWindowError),g&&g(a.ErrorCodes.popUpWindowError+":"+a.ErrorDescription.popUpWindowError),null;var j=window.setInterval(function(){i&&!i.closed&&void 0!==i.closed||(e._loginInProgress=!1,e._acquireTokenInProgress=!1,window.clearInterval(j));try{-1!==i.location.href.indexOf(h.redirectUri)&&(h.handleAuthenticationResponse(i.location.hash,f,g),window.clearInterval(j),e._loginInProgress=!1,e._acquireTokenInProgress=!1,h._requestContext.logger.info("Closing popup window"),i.close())}catch(a){}},d);return i},c.prototype.logout=function(){this.clearCache(),this._user=null;var a="";this.postLogoutredirectUri&&(a="post_logout_redirect_uri="+encodeURIComponent(this.postLogoutredirectUri));var b=this.authority+"/oauth2/v2.0/logout?"+a;this.promptUser(b)},c.prototype.clearCache=function(){this._renewStates=[];for(var b=this._cacheStorage.getAllAccessTokens(a.Constants.clientId,a.Constants.authority),c=0;c<b.length;c++)this._cacheStorage.removeItem(JSON.stringify(b[c].key));this._cacheStorage.removeAcquireTokenEntries(a.Constants.acquireTokenUser,a.Constants.renewStatus),this._cacheStorage.removeAcquireTokenEntries(a.Constants.authority+a.Constants.resourceDelimeter,a.Constants.renewStatus),this._cacheStorage.resetCacheItems()},c.prototype.openPopup=function(a,b,c,d){try{var e=window.screenLeft?window.screenLeft:window.screenX,f=window.screenTop?window.screenTop:window.screenY,g=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=g/2-c/2+e,j=h/2-d/2+f,k=window.open(a,b,"width="+c+", height="+d+", top="+j+", left="+i);return k.focus&&k.focus(),k}catch(a){return this._requestContext.logger.error("error opening popup "+a.message),this._loginInProgress=!1,this._acquireTokenInProgress=!1,null}},c.prototype.validateInputScope=function(a){if(!a||a.length<1)return"Scopes cannot be passed as an empty array";if(!Array.isArray(a))throw new Error("API does not accept non-array scopes");return a.indexOf(this.clientId)>-1&&a.length>1?"ClientId can only be provided as a single scope":""},c.prototype.filterScopes=function(a){return a=a.filter(function(a){return"openid"!==a}),a=a.filter(function(a){return"profile"!==a})},c.prototype.registerCallback=function(a,b,c,d){var e=this;this._activeRenewals[b]=a,window.callBacksMappedToRenewStates[a]||(window.callBacksMappedToRenewStates[a]=[]),window.callBacksMappedToRenewStates[a].push({resolve:c,reject:d}),window.callBackMappedToRenewStates[a]||(window.callBackMappedToRenewStates[a]=function(c,d,f,g){e._activeRenewals[b]=null;for(var h=0;h<window.callBacksMappedToRenewStates[a].length;++h)try{c||f?window.callBacksMappedToRenewStates[a][h].reject(c+": "+f):d&&window.callBacksMappedToRenewStates[a][h].resolve(d)}catch(a){e._requestContext.logger.warning(a)}window.callBacksMappedToRenewStates[a]=null,window.callBackMappedToRenewStates[a]=null})},c.prototype.getCachedToken=function(b,c){var d=null,e=b.scopes,f=this._cacheStorage.getAllAccessTokens(this.clientId,c.userIdentifier);if(0===f.length)return null;var g=[];if(b.authority){for(var h=0;h<f.length;h++){var i=f[h],j=i.key.scopes.split(" ");a.Utils.containsScope(j,e)&&i.key.authority===b.authority&&g.push(i)}if(0===g.length)return null;if(1!==g.length)return{errorDesc:"The cache contains multiple tokens satisfying the requirements.Call AcquireToken again providing more requirements like authority",token:null,error:"multiple_matching_tokens_detected"};d=g[0]}else{for(var h=0;h<f.length;h++){var i=f[h],j=i.key.scopes.split(" ");a.Utils.containsScope(j,e)&&g.push(i)}if(1===g.length)d=g[0],b.authorityInstance=a.Authority.CreateInstance(d.key.authority,this.validateAuthority);else{if(g.length>1)return{errorDesc:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements like authority",token:null,error:"multiple_matching_tokens_detected"};var k=this.getUniqueAuthority(f,"authority");if(k.length>1)return{errorDesc:"Multiple authorities found in the cache. Pass authority in the API overload.",token:null,error:"multiple_matching_tokens_detected"};b.authorityInstance=a.Authority.CreateInstance(k[0],this.validateAuthority)}}if(null!=d){var l=Number(d.value.expiresIn),m=this._clockSkew||300;return l&&l>a.Utils.now()+m?{errorDesc:null,token:d.value.accessToken,error:null}:(this._cacheStorage.removeItem(JSON.stringify(g[0].key)),null)}return null},c.prototype.getAllUsers=function(){for(var b=[],c=this._cacheStorage.getAllAccessTokens(a.Constants.clientId,a.Constants.authority),d=0;d<c.length;d++){var e=new a.IdToken(c[d].value.idToken),f=new a.ClientInfo(c[d].value.clientInfo),g=a.User.createUser(e,f,this.authority);b.push(g)}return this.getUniqueUsers(b)},c.prototype.getUniqueUsers=function(a){if(!a||a.length<=1)return a;for(var b=[],c=[],d=0;d<a.length;++d)a[d].userIdentifier&&-1===b.indexOf(a[d].userIdentifier)&&(b.push(a[d].userIdentifier),c.push(a[d]));return c},c.prototype.getUniqueAuthority=function(a,b){var c=[],d=[];return a.forEach(function(a){a.key.hasOwnProperty(b)&&-1===d.indexOf(a.key[b])&&(d.push(a.key[b]),c.push(a.key[b]))}),c},c.prototype.addHintParameters=function(b,c){var d=c||this._user,e=d.userIdentifier.split("."),f=a.Utils.base64DecodeStringUrlSafe(e[0]),g=a.Utils.base64DecodeStringUrlSafe(e[1]);return d.displayableId&&!a.Utils.isEmpty(d.displayableId)&&(b+="&login_hint="+encodeURIComponent(c.displayableId)),
a.Utils.isEmpty(f)||a.Utils.isEmpty(g)||(this.urlContainsQueryStringParameter("domain_req",b)||a.Utils.isEmpty(g)||(b+="&domain_req="+encodeURIComponent(g)),this.urlContainsQueryStringParameter("login_req",b)||a.Utils.isEmpty(f)||(b+="&login_req="+encodeURIComponent(f)),this.urlContainsQueryStringParameter("domain_hint",b)||a.Utils.isEmpty(g)||(b+="9188040d-6c67-4c5b-b112-36a304b66dad"===g?"&domain_hint="+encodeURIComponent("consumers"):"&domain_hint="+encodeURIComponent("organizations"))),b},c.prototype.urlContainsQueryStringParameter=function(a,b){return new RegExp("[\\?&]"+a+"=").test(b)},c.prototype.acquireTokenRedirect=function(c,d,e,f){var g=this,h=this.validateInputScope(c);if(h&&!a.Utils.isEmpty(h)&&this._tokenReceivedCallback)return void this._tokenReceivedCallback(h,null,null,a.Constants.accessToken);c&&(c=this.filterScopes(c));var i=e||this._user;if(!this._acquireTokenInProgress){c.join(" ").toLowerCase();if(!i&&this._tokenReceivedCallback)return void this._tokenReceivedCallback(a.ErrorDescription.userLoginError,null,a.ErrorCodes.userLoginError,a.Constants.accessToken);this._acquireTokenInProgress=!0;var j,k=d?a.Authority.CreateInstance(d,this.validateAuthority):this.authorityInstance;k.ResolveEndpointsAsync().then(function(){j=a.Utils.compareObjects(i,g._user)?new a.AuthenticationRequestParameters(k,g.clientId,c,b.token,g.redirectUri):new a.AuthenticationRequestParameters(k,g.clientId,c,b.id_token_token,g.redirectUri),g._cacheStorage.setItem(a.Constants.nonceIdToken,j.nonce);var d=a.Constants.acquireTokenUser+a.Constants.resourceDelimeter+i.userIdentifier+a.Constants.resourceDelimeter+j.state;a.Utils.isEmpty(g._cacheStorage.getItem(d))&&g._cacheStorage.setItem(d,JSON.stringify(i));var e=a.Constants.authority+a.Constants.resourceDelimeter+j.state;a.Utils.isEmpty(g._cacheStorage.getItem(e))&&g._cacheStorage.setItem(e,k.CanonicalAuthority),f&&(j.extraQueryParameters=f);var h=j.createNavigateUrl(c)+"&prompt=select_account&response_mode=fragment";(h=g.addHintParameters(h,i))&&(g._cacheStorage.setItem(a.Constants.stateAcquireToken,j.state),window.location.replace(h))})}},c.prototype.acquireTokenPopup=function(c,d,e,f){var g=this;return new Promise(function(h,i){g._interactionMode=g._interactionModes.popUp;var j=g.validateInputScope(c);j&&!a.Utils.isEmpty(j)&&i(a.ErrorCodes.inputScopesError+":"+j),c&&(c=g.filterScopes(c));var k=e||g._user;if(g._acquireTokenInProgress)return void i(a.ErrorCodes.acquireTokenProgressError+":"+a.ErrorDescription.acquireTokenProgressError);var l=c.join(" ").toLowerCase();if(!k)return void i(a.ErrorCodes.userLoginError+":"+a.ErrorDescription.userLoginError);g._acquireTokenInProgress=!0;var m,n=d?a.Authority.CreateInstance(d,g.validateAuthority):g.authorityInstance,o=g.openWindow("about:blank","_blank",1,g,h,i);o&&n.ResolveEndpointsAsync().then(function(){m=a.Utils.compareObjects(k,g._user)?new a.AuthenticationRequestParameters(n,g.clientId,c,b.token,g.redirectUri):new a.AuthenticationRequestParameters(n,g.clientId,c,b.id_token_token,g.redirectUri),g._cacheStorage.setItem(a.Constants.nonceIdToken,m.nonce),m.state=m.state;var d=a.Constants.acquireTokenUser+a.Constants.resourceDelimeter+k.userIdentifier+a.Constants.resourceDelimeter+m.state;a.Utils.isEmpty(g._cacheStorage.getItem(d))&&g._cacheStorage.setItem(d,JSON.stringify(k));var e=a.Constants.authority+a.Constants.resourceDelimeter+m.state;a.Utils.isEmpty(g._cacheStorage.getItem(e))&&g._cacheStorage.setItem(e,n.CanonicalAuthority),f&&(m.extraQueryParameters=f);var j=m.createNavigateUrl(c)+"&prompt=select_account&response_mode=fragment";j=g.addHintParameters(j,k),g._renewStates.push(m.state),g.registerCallback(m.state,l,h,i),o&&(o.location.href=j)},function(){g._requestContext.logger.info(a.ErrorCodes.endpointResolutionError+":"+a.ErrorDescription.endpointResolutionError),g._cacheStorage.setItem(a.Constants.error,a.ErrorCodes.endpointResolutionError),g._cacheStorage.setItem(a.Constants.errorDescription,a.ErrorDescription.endpointResolutionError),i&&i(a.ErrorCodes.endpointResolutionError+":"+a.ErrorDescription.endpointResolutionError),o&&o.close()})})},c.prototype.acquireTokenSilent=function(c,d,e,f){var g=this;return new Promise(function(h,i){var j=g.validateInputScope(c);if(!j||a.Utils.isEmpty(j)){c&&(c=g.filterScopes(c));var k=c.join(" ").toLowerCase(),l=e||g._user;if(!l)return void i(a.ErrorCodes.userLoginError+":"+a.ErrorDescription.userLoginError);var m,n=d?a.Authority.CreateInstance(d,g.validateAuthority):g.authorityInstance;m=a.Utils.compareObjects(l,g._user)?new a.AuthenticationRequestParameters(n,g.clientId,c,b.token,g.redirectUri):new a.AuthenticationRequestParameters(n,g.clientId,c,b.id_token_token,g.redirectUri);var o=g.getCachedToken(m,l);if(o){if(o.token)return g._requestContext.logger.info("Token is already in cache for scope:"+k),void h(o.token);if(o.errorDesc||o.error)return g._requestContext.logger.info(o.errorDesc+":"+o.error),void i(o.errorDesc+": "+o.error)}return g._activeRenewals[k]&&g.registerCallback(g._activeRenewals[k],k,h,i),g.authorityInstance.ResolveEndpointsAsync().then(function(){c&&c.indexOf(g.clientId)>-1&&1===c.length?(g._requestContext.logger.verbose("renewing idToken"),g.renewIdToken(c,h,i,l,m,f)):(g._requestContext.logger.verbose("renewing accesstoken"),g.renewToken(c,h,i,l,m,f))})}i(a.ErrorCodes.inputScopesError+":"+j)})},c.prototype.loadFrameTimeout=function(b,c,d){var e=this;this._requestContext.logger.verbose("Set loading state to pending for: "+d),this._cacheStorage.setItem(a.Constants.renewStatus+d,a.Constants.tokenRenewStatusInProgress),this.loadFrame(b,c),setTimeout(function(){if(e._cacheStorage.getItem(a.Constants.renewStatus+d)===a.Constants.tokenRenewStatusInProgress){e._requestContext.logger.verbose("Loading frame has timed out after: "+a.Constants.loadFrameTimeout/1e3+" seconds for scope "+d);var b=e._activeRenewals[d];b&&window.callBackMappedToRenewStates[b]&&window.callBackMappedToRenewStates[b]("Token renewal operation failed due to timeout",null,null,a.Constants.accessToken),e._cacheStorage.setItem(a.Constants.renewStatus+d,a.Constants.tokenRenewStatusCancelled)}},a.Constants.loadFrameTimeout)},c.prototype.loadFrame=function(a,b){var c=this;this._requestContext.logger.info("LoadFrame: "+b);var d=b;setTimeout(function(){var b=c.addAdalFrame(d);""!==b.src&&"about:blank"!==b.src||(b.src=a)},500)},c.prototype.addAdalFrame=function(a){if(void 0===a)return null;this._requestContext.logger.info("Add msal frame to document:"+a);var b=document.getElementById(a);if(!b){if(document.createElement&&document.documentElement&&-1===window.navigator.userAgent.indexOf("MSIE 5.0")){var c=document.createElement("iframe");c.setAttribute("id",a),c.style.visibility="hidden",c.style.position="absolute",c.style.width=c.style.height="0",b=document.getElementsByTagName("body")[0].appendChild(c)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+a+'" id="'+a+'" style="display:none"></iframe>');window.frames&&window.frames[a]&&(b=window.frames[a])}return b},c.prototype.renewToken=function(b,c,d,e,f,g){var h=b.join(" ").toLowerCase();this._requestContext.logger.verbose("renewToken is called for scope:"+h);var i=this.addAdalFrame("msalRenewFrame"+h);g&&(f.extraQueryParameters=g);var j=a.Constants.acquireTokenUser+a.Constants.resourceDelimeter+e.userIdentifier+a.Constants.resourceDelimeter+f.state;a.Utils.isEmpty(this._cacheStorage.getItem(j))&&this._cacheStorage.setItem(j,JSON.stringify(e));var k=a.Constants.authority+a.Constants.resourceDelimeter+f.state;a.Utils.isEmpty(this._cacheStorage.getItem(k))&&this._cacheStorage.setItem(k,f.authority),this._cacheStorage.setItem(a.Constants.nonceIdToken,f.nonce),this._requestContext.logger.verbose("Renew token Expected state: "+f.state);var l=f.createNavigateUrl(b)+"&prompt=none";l=this.addHintParameters(l,e),this._renewStates.push(f.state),this.registerCallback(f.state,h,c,d),this._requestContext.logger.infoPii("Navigate to:"+l),i.src="about:blank",this.loadFrameTimeout(l,"msalRenewFrame"+h,h)},c.prototype.renewIdToken=function(b,c,d,e,f,g){b.join(" ").toLowerCase();this._requestContext.logger.info("renewidToken is called");var h=this.addAdalFrame("msalIdTokenFrame");g&&(f.extraQueryParameters=g);var i=a.Constants.acquireTokenUser+a.Constants.resourceDelimeter+e.userIdentifier+a.Constants.resourceDelimeter+f.state;a.Utils.isEmpty(this._cacheStorage.getItem(i))&&this._cacheStorage.setItem(i,JSON.stringify(e));var j=a.Constants.authority+a.Constants.resourceDelimeter+f.state;a.Utils.isEmpty(this._cacheStorage.getItem(j))&&this._cacheStorage.setItem(j,f.authority),this._cacheStorage.setItem(a.Constants.nonceIdToken,f.nonce),this._requestContext.logger.verbose("Renew Idtoken Expected state: "+f.state);var k=f.createNavigateUrl(b)+"&prompt=none";k=this.addHintParameters(k,e),this._renewStates.push(f.state),this.registerCallback(f.state,this.clientId,c,d),this._requestContext.logger.infoPii("Navigate to:"+k),h.src="about:blank",this.loadFrameTimeout(k,"adalIdTokenFrame",this.clientId)},c.prototype.getUser=function(){if(this._user)return this._user;var b=this._cacheStorage.getItem(a.Constants.idTokenKey),c=this._cacheStorage.getItem(a.Constants.clientInfo);if(!a.Utils.isEmpty(b)&&!a.Utils.isEmpty(c)){var d=new a.IdToken(b),e=new a.ClientInfo(c);return this._user=a.User.createUser(d,e,this.authority),this._user}return null},c.prototype.handleAuthenticationResponse=function(b,c,d){if(null==b&&(b=window.location.hash),this.isCallback(b)){var e=this.getRequestInfo(b);this._requestContext.logger.info("Returned from redirect url"),this.saveTokenFromHash(e);var f=null,g=null,h=void 0;e.requestType===a.Constants.renewToken&&window.parent?(window.parent!==window?this._requestContext.logger.verbose("Window is in iframe, acquiring token silently"):this._requestContext.logger.verbose("acquiring token interactive in progress"),g=window.parent.callBackMappedToRenewStates[e.stateResponse]?window.parent.callBackMappedToRenewStates[e.stateResponse]:this._tokenReceivedCallback,f=e.parameters[a.Constants.accessToken]||e.parameters[a.Constants.idToken],h=a.Constants.accessToken):e.requestType===a.Constants.login&&(g=this._tokenReceivedCallback,f=e.parameters[a.Constants.idToken],h=a.Constants.idToken);try{var i=e.parameters[a.Constants.errorDescription],j=e.parameters[a.Constants.error];d&&c?j||i?d(i+":"+j):f&&c(f):g&&g(i,f,j,h)}catch(a){this._requestContext.logger.error("Error occurred in token received callback function: "+a)}this._interactionMode!==this._interactionModes.popUp&&(window.location.hash="",this.navigateToLoginRequestUrl&&window.location.href.replace("#","")!==this._cacheStorage.getItem(a.Constants.loginRequest)&&(window.location.href=this._cacheStorage.getItem(a.Constants.loginRequest)))}},c.prototype.saveAccessToken=function(b,c,d,e,f){var g,h=new a.ClientInfo(e);if(c.parameters.hasOwnProperty("scope")){g=c.parameters.scope;for(var i=g.split(" "),j=this._cacheStorage.getAllAccessTokens(this.clientId,b),k=0;k<j.length;k++){var l=j[k];if(l.key.userIdentifier===d.userIdentifier){var m=l.key.scopes.split(" ");a.Utils.isIntersectingScopes(m,i)&&this._cacheStorage.removeItem(JSON.stringify(l.key))}}var n=new a.AccessTokenKey(b,this.clientId,g,h.uid,h.utid),o=new a.AccessTokenValue(c.parameters[a.Constants.accessToken],f.rawIdToken,a.Utils.expiresIn(c.parameters[a.Constants.expiresIn]).toString(),e);this._cacheStorage.setItem(JSON.stringify(n),JSON.stringify(o))}else{g=this.clientId;var n=new a.AccessTokenKey(b,this.clientId,g,h.uid,h.utid),o=new a.AccessTokenValue(c.parameters[a.Constants.idToken],c.parameters[a.Constants.idToken],f.expiration,e);this._cacheStorage.setItem(JSON.stringify(n),JSON.stringify(o))}},c.prototype.saveTokenFromHash=function(b){this._requestContext.logger.info("State status:"+b.stateMatch+"; Request type:"+b.requestType),this._cacheStorage.setItem(a.Constants.error,""),this._cacheStorage.setItem(a.Constants.errorDescription,"");var c="";if(c=b.parameters.hasOwnProperty("scope")?b.parameters.scope:this.clientId,b.parameters.hasOwnProperty(a.Constants.errorDescription)||b.parameters.hasOwnProperty(a.Constants.error))this._requestContext.logger.info("Error :"+b.parameters[a.Constants.error]+"; Error description:"+b.parameters[a.Constants.errorDescription]),this._cacheStorage.setItem(a.Constants.error,b.parameters.error),this._cacheStorage.setItem(a.Constants.errorDescription,b.parameters[a.Constants.errorDescription]),b.requestType===a.Constants.login&&(this._loginInProgress=!1,this._cacheStorage.setItem(a.Constants.loginError,b.parameters[a.Constants.errorDescription]+":"+b.parameters[a.Constants.error])),b.requestType===a.Constants.renewToken&&(this._acquireTokenInProgress=!1);else if(b.stateMatch){this._requestContext.logger.info("State is right"),b.parameters.hasOwnProperty(a.Constants.sessionState)&&this._cacheStorage.setItem(a.Constants.sessionState,b.parameters[a.Constants.sessionState]);var d,e="";if(b.parameters.hasOwnProperty(a.Constants.accessToken)){this._requestContext.logger.info("Fragment has access token"),this._acquireTokenInProgress=!1;var f=void 0;d=b.parameters.hasOwnProperty(a.Constants.idToken)?new a.IdToken(b.parameters[a.Constants.idToken]):new a.IdToken(this._cacheStorage.getItem(a.Constants.idTokenKey));var g=a.Constants.authority+a.Constants.resourceDelimeter+b.stateResponse,h=void 0;a.Utils.isEmpty(this._cacheStorage.getItem(g))||(h=this._cacheStorage.getItem(g),h=a.Utils.replaceFirstPath(h,d.tenantId)),b.parameters.hasOwnProperty(a.Constants.clientInfo)?(e=b.parameters[a.Constants.clientInfo],f=a.User.createUser(d,new a.ClientInfo(e),h)):(this._requestContext.logger.warning("ClientInfo not received in the response from AAD"),f=a.User.createUser(d,new a.ClientInfo(e),h));var i=a.Constants.acquireTokenUser+a.Constants.resourceDelimeter+f.userIdentifier+a.Constants.resourceDelimeter+b.stateResponse,j=void 0;a.Utils.isEmpty(this._cacheStorage.getItem(i))||(j=JSON.parse(this._cacheStorage.getItem(i)),f&&j&&a.Utils.compareObjects(f,j)?(this.saveAccessToken(h,b,f,e,d),this._requestContext.logger.info("The user object received in the response is the same as the one passed in the acquireToken request")):this._requestContext.logger.warning("The user object created from the response is not the same as the one passed in the acquireToken request"))}if(b.parameters.hasOwnProperty(a.Constants.idToken)&&c.indexOf(this.clientId)>-1){this._requestContext.logger.info("Fragment has id token"),this._loginInProgress=!1,d=new a.IdToken(b.parameters[a.Constants.idToken]),b.parameters.hasOwnProperty(a.Constants.clientInfo)?e=b.parameters[a.Constants.clientInfo]:this._requestContext.logger.warning("ClientInfo not received in the response from AAD");var g=a.Constants.authority+a.Constants.resourceDelimeter+b.stateResponse,h=void 0;a.Utils.isEmpty(this._cacheStorage.getItem(g))||(h=this._cacheStorage.getItem(g),h=a.Utils.replaceFirstPath(h,d.tenantId)),this._user=a.User.createUser(d,new a.ClientInfo(e),h),d&&d.nonce?d.nonce!==this._cacheStorage.getItem(a.Constants.nonceIdToken)?(this._user=null,this._cacheStorage.setItem(a.Constants.loginError,"Nonce Mismatch.Expected: "+this._cacheStorage.getItem(a.Constants.nonceIdToken)+",Actual: "+d.nonce)):(this._cacheStorage.setItem(a.Constants.idTokenKey,b.parameters[a.Constants.idToken]),this._cacheStorage.setItem(a.Constants.clientInfo,e),this.saveAccessToken(h,b,this._user,e,d)):(this._cacheStorage.setItem(a.Constants.error,"invalid idToken"),this._cacheStorage.setItem(a.Constants.errorDescription,"Invalid idToken. idToken: "+b.parameters[a.Constants.idToken]))}}else this._cacheStorage.setItem(a.Constants.error,"Invalid_state"),this._cacheStorage.setItem(a.Constants.errorDescription,"Invalid_state. state: "+b.stateResponse);this._cacheStorage.setItem(a.Constants.renewStatus+c,a.Constants.tokenRenewStatusCompleted),this._cacheStorage.removeAcquireTokenEntries(a.Constants.acquireTokenUser,a.Constants.renewStatus),this._cacheStorage.removeAcquireTokenEntries(a.Constants.authority+a.Constants.resourceDelimeter,a.Constants.renewStatus)},c.prototype.isCallback=function(b){b=this.getHash(b);var c=a.Utils.deserialize(b);return c.hasOwnProperty(a.Constants.errorDescription)||c.hasOwnProperty(a.Constants.error)||c.hasOwnProperty(a.Constants.accessToken)||c.hasOwnProperty(a.Constants.idToken)},c.prototype.getHash=function(a){return a.indexOf("#/")>-1?a=a.substring(a.indexOf("#/")+2):a.indexOf("#")>-1&&(a=a.substring(1)),a},c.prototype.getRequestInfo=function(b){b=this.getHash(b);var c=a.Utils.deserialize(b),d=new a.TokenResponse;if(c&&(d.parameters=c,c.hasOwnProperty(a.Constants.errorDescription)||c.hasOwnProperty(a.Constants.error)||c.hasOwnProperty(a.Constants.accessToken)||c.hasOwnProperty(a.Constants.idToken))){d.valid=!0;var e=void 0;if(!c.hasOwnProperty("state"))return d;if(e=c.state,d.stateResponse=e,e===this._cacheStorage.getItem(a.Constants.stateLogin))return d.requestType=a.Constants.login,d.stateMatch=!0,d;if(e===this._cacheStorage.getItem(a.Constants.stateAcquireToken))return d.requestType=a.Constants.renewToken,d.stateMatch=!0,d;if(!d.stateMatch&&window.parent&&window.parent.msal)for(var f=window.parent.msal,g=f._renewStates,h=0;h<g.length;h++)if(g[h]===d.stateResponse){d.requestType=a.Constants.renewToken,d.stateMatch=!0;break}}return d},c.prototype.getScopeFromState=function(a){if(a){var b=a.indexOf("|");if(b>-1&&b+1<a.length)return a.substring(b+1)}return""},c}();a.UserAgentApplication=c}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function a(){}return a.compareObjects=function(a,b){return!(!a||!b)&&!(!a.userIdentifier||!b.userIdentifier||a.userIdentifier!==b.userIdentifier)},a.expiresIn=function(a){return a||(a="3599"),this.now()+parseInt(a,10)},a.now=function(){return Math.round((new Date).getTime()/1e3)},a.isEmpty=function(a){return void 0===a||!a||0===a.length},a.extractIdToken=function(a){var b=this.decodeJwt(a);if(!b)return null;try{var c=b.JWSPayload,d=this.base64DecodeStringUrlSafe(c);return d?JSON.parse(d):null}catch(a){}return null},a.base64EncodeStringUrlSafe=function(a){return window.btoa?window.btoa(a):this.encode(a)},a.base64DecodeStringUrlSafe=function(a){return a=a.replace(/-/g,"+").replace(/_/g,"/"),window.atob?decodeURIComponent(window.atob(a)):decodeURIComponent(this.decode(a))},a.encode=function(a){var b,c,d,e,f,g,h,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",j="",k=0;for(a=this.utf8Encode(a);k<a.length;)b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),j=j+i.charAt(e)+i.charAt(f)+i.charAt(g)+i.charAt(h);return j.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},a.utf8Encode=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},a.decode=function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a=String(a).replace(/=+$/,"");var c=a.length;if(c%4==1)throw new Error("The token to be decoded is not correctly encoded.");for(var d,e,f,g,h,i,j,k,l="",m=0;m<c;m+=4){if(d=b.indexOf(a.charAt(m)),e=b.indexOf(a.charAt(m+1)),f=b.indexOf(a.charAt(m+2)),g=b.indexOf(a.charAt(m+3)),m+2===c-1){h=d<<18|e<<12|f<<6,i=h>>16&255,j=h>>8&255,l+=String.fromCharCode(i,j);break}if(m+1===c-1){h=d<<18|e<<12,i=h>>16&255,l+=String.fromCharCode(i);break}h=d<<18|e<<12|f<<6|g,i=h>>16&255,j=h>>8&255,k=255&h,l+=String.fromCharCode(i,j,k)}return l},a.decodeJwt=function(a){if(this.isEmpty(a))return null;var b=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/,c=b.exec(a);return!c||c.length<4?null:{header:c[1],JWSPayload:c[2],JWSSig:c[3]}},a.deserialize=function(a){var b,c=/([^&=]+)=([^&]*)/g,d=function(a){return decodeURIComponent(a.replace(/\+/g," "))},e={};for(b=c.exec(a);b;)e[d(b[1])]=d(b[2]),b=c.exec(a);return e},a.isIntersectingScopes=function(a,b){a=this.convertToLowerCase(a);for(var c=0;c<b.length;c++)if(a.indexOf(b[c].toLowerCase())>-1)return!0;return!1},a.containsScope=function(a,b){return a=this.convertToLowerCase(a),b.every(function(b){return a.indexOf(b.toString().toLowerCase())>=0})},a.convertToLowerCase=function(a){return a.map(function(a){return a.toLowerCase()})},a.removeElement=function(a,b){return a.filter(function(a){return a!==b})},a.decimalToHex=function(a){for(var b=a.toString(16);b.length<2;)b="0"+b;return b},a.getLibraryVersion=function(){return"0.1.1"},a.replaceFirstPath=function(b,c){if(b.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/)){var d=a.GetUrlComponents(b),e=d.PathSegments;e.shift(),(e[0]&&"common"===e[0]||"organizations"===e[0])&&(e[0]=c,b=d.Protocol+"//"+d.HostNameAndPort+"/"+e.join("/"))}return b},a.createNewGuid=function(){var b=window.crypto;if(b&&b.getRandomValues){var c=new Uint8Array(16);return b.getRandomValues(c),c[6]|=64,c[6]&=79,c[8]|=128,c[8]&=191,a.decimalToHex(c[0])+a.decimalToHex(c[1])+a.decimalToHex(c[2])+a.decimalToHex(c[3])+"-"+a.decimalToHex(c[4])+a.decimalToHex(c[5])+"-"+a.decimalToHex(c[6])+a.decimalToHex(c[7])+"-"+a.decimalToHex(c[8])+a.decimalToHex(c[9])+"-"+a.decimalToHex(c[10])+a.decimalToHex(c[11])+a.decimalToHex(c[12])+a.decimalToHex(c[13])+a.decimalToHex(c[14])+a.decimalToHex(c[15])}for(var d="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",e="0123456789abcdef",f=0,g="",h=0;h<36;h++)"-"!==d[h]&&"4"!==d[h]&&(f=16*Math.random()|0),"x"===d[h]?g+=e[f]:"y"===d[h]?(f&=3,f|=8,g+=e[f]):g+=d[h];return g},a.GetUrlComponents=function(a){if(!a)throw"Url required";var b=new RegExp(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/),c=a.match(b);if(!c||c.length<6)throw"Valid url required";var d={Protocol:c[1],HostNameAndPort:c[4],AbsolutePath:c[5]},e=d.AbsolutePath.split("/");return e=e.filter(function(a){return a&&a.length>0}),d.PathSegments=e,d},a.CanonicalizeUri=function(b){return b&&(b=b.toLowerCase()),b&&!a.endsWith(b,"/")&&(b+="/"),b},a.endsWith=function(a,b){return!(!a||!b)&&-1!==a.indexOf(b,a.length-b.length)},a}();a.Utils=b}(Msal||(Msal={}));var Msal;!function(a){var b=function(){function a(){}return a.prototype.sendRequestAsync=function(a,b,c){var d=this;return new Promise(function(c,e){var f=new XMLHttpRequest;if(f.open(b,a,!0),f.onload=function(a){(f.status<200||f.status>=300)&&e(d.handleError(f.responseText));try{var b=JSON.parse(f.responseText)}catch(a){e(d.handleError(f.responseText))}c(b)},f.onerror=function(a){e(f.status)},"GET"!=b)throw"not implemented";f.send()})},a.prototype.handleError=function(a){var b;try{if(b=JSON.parse(a),b.error)return b.error;throw a}catch(b){return a}},a}();a.XhrClient=b}(Msal||(Msal={}));